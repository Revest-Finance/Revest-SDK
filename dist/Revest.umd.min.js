/*!
 * revest-sdk-core
 * Revest
 *
 * @version v1.0.0
 * @author Revest Team
 * @homepage https://github.com/Revest-Finance/Revest-SDK#readme
 * @repository git+https://github.com/Revest-Finance/Revest-SDK.git
 * @license MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Revest=t()}(this,(function(){"use strict";function e(e,t,n,a,i,r,s){try{var o=e[r](s),u=o.value}catch(e){return void n(e)}o.done?t(u):Promise.resolve(u).then(a,i)}function t(t){return function(){var n=this,a=arguments;return new Promise((function(i,r){var s=t.apply(n,a);function o(t){e(s,i,r,o,u,"next",t)}function u(t){e(s,i,r,o,u,"throw",t)}o(void 0)}))}}function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?a(Object(i),!0).forEach((function(t){n(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}const r={1:"https://api.thegraph.com/subgraphs/name/alexvorobiov/eip1155subgraph",137:"https://thegraph.com/hosted-service/subgraph/iskdrews/erc1155polygon-subgraphone",250:"https://api.thegraph.com/subgraphs/name/iskdrews/erc1155one",43114:"https://thegraph.com/hosted-service/subgraph/iskdrews/erc1155avax-one"},s={1:{MIN_BLOCK:9005417,ROUTER:"0xD721A90dd7e010c8C5E022cc0100c55aC78E0FC4",PROVIDER:"https://eth-mainnet.alchemyapi.io/v2/zOVFUzSEld1v_MuTOqGPYkTYttwBUrmF",UNISWAP:"0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f",NFT_LOCKER:"0xc3B4F9fD4CadDc30797818Fd0A38BbF01d9E6000",ETHERSCAN_API:"https://api.etherscan.io",MULTICALL:"0xeefba1e63905ef1d7acba5a8513c70307c1ce441"},4:{MIN_BLOCK:9005417,ROUTER:"0x21744C9A65608645E1b39a4596C39848078C2865",PROVIDER:"https://eth-rinkeby.alchemyapi.io/v2/srVBZIhy3PWWN1URQfd-KlTJk8q964kr",UNISWAP:"0x5C69bEe701ef814a2B6a3EDD4B1652CB9cc5aA6f",NFT_LOCKER:"0x1Ce0f18C2df349341D7c223dc0EB09d1DfAa94e2",ETHERSCAN_API:"https://api-rinkeby.etherscan.io",MULTICALL:"0x42ad527de7d4e9d9d011ac45b31d8551f8fe9821"},137:{MIN_BLOCK:21525737,ROUTER:"0xC03bB46b3BFD42e6a2bf20aD6Fa660e4Bd3736F8",PROVIDER:"https://polygon-mainnet.g.alchemy.com/v2/XZF2U-6qLByJKH9OVsB8rflwSYaZRQaq",UNISWAP:"0x5757371414417b8C6CAad45bAeF941aBc7d3Ab32",NFT_LOCKER:"0x74fB7d0dA80CEb606872B33c6BCd3cC458BB43aF",ETHERSCAN_API:"https://api.polygonscan.com",MULTICALL:"0xCBca837161be50EfA5925bB9Cc77406468e76751"},250:{MIN_BLOCK:22917309,ROUTER:"0xe0741aE6a8A6D87A68B7b36973d8740704Fd62B9",PROVIDER:"https://rpc.ftm.tools",UNISWAP:"0x152eE697f2E276fA89E96742e9bB9aB1F2E61bE3",NFT_LOCKER:"0x07317eD9204C9e76df03f106CeFfD5b021C5f6A5",ETHERSCAN_API:"https://api.FtmScan.com",MULTICALL:"0x7f6A10218264a22B4309F3896745687E712962a0"},43114:{MIN_BLOCK:7469820,ROUTER:"0x64e12fEA089e52A06A7A76028C809159ba4c1b1a",NFT_LOCKER:"0x7f95E5821D0a9FF60Bf6e1D454E980eE34382d62",PROVIDER:"https://api.avax.network/ext/bc/C/rpc",UNISWAP:"0xefa94DE7a4656D787667C749f7E1223D71E9FD88",ETHERSCAN_API:"https://api.snowtrace.io",MULTICALL:"0x7E9985aE4C8248fdB07607648406a48C76e9e7eD"}},o=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{inputs:[],name:"ADMIN",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"ESCROW",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"FNFT",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"LIQUIDITY_TOKENS",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"LOCK_MANAGER",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"METADATA",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"REVEST",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"REVEST_TOKEN",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"TOKEN_VAULT",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"_addresses",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"_dex",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"id",type:"bytes32"}],name:"getAddress",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getAdmin",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"getDEX",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getLPs",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getLockManager",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getMetadataHandler",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getRevest",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getRevestFNFT",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getRevestToken",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getRewardsHandler",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getTokenVault",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"lock_manager_",type:"address"},{internalType:"address",name:"liquidity_",type:"address"},{internalType:"address",name:"revest_token_",type:"address"},{internalType:"address",name:"token_vault_",type:"address"},{internalType:"address",name:"revest_",type:"address"},{internalType:"address",name:"fnft_",type:"address"},{internalType:"address",name:"metadata_",type:"address"},{internalType:"address",name:"admin_",type:"address"},{internalType:"address",name:"rewards_",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"next_dex",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"admin",type:"address"}],name:"setAdmin",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"dex",type:"address"}],name:"setDex",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"liquidToken",type:"address"}],name:"setLPs",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"manager",type:"address"}],name:"setLockManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"metadata",type:"address"}],name:"setMetadataHandler",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"revest",type:"address"}],name:"setRevest",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"fnft",type:"address"}],name:"setRevestFNFT",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"}],name:"setRevestToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"esc",type:"address"}],name:"setRewardsHandler",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"vault",type:"address"}],name:"setTokenVault",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"}];var u=function(e){this.value=e},p=Object.defineProperty({EnumType:u},"__esModule",{value:!0}),d=function(){function e(e){this.value=e}return e.prototype.toJSON=function(){return"$"+this.value},e}(),c=Object.defineProperty({VariableType:d},"__esModule",{value:!0}),y=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e,t){function n(e){return e instanceof p.EnumType?e.value:e instanceof c.VariableType?"$"+e.value:"object"!=typeof e||null===e?JSON.stringify(e):Array.isArray(e)?"["+e.map((function(e){return n(e)})).join(", ")+"]":"{"+Object.keys(e).map((function(t){return t+": "+n(e[t])})).join(", ")+"}"}function a(e,n){return-1==t.configFields.indexOf(e)&&-1==n.indexOf(e)}function i(e,t,r,s){Object.keys(e).filter((function(e){return a(e,s.ignoreFields)})).forEach((function(o){var u=e[o];if("object"==typeof u){if(Array.isArray(u)&&!(u=u.find((function(e){return e&&"object"==typeof e}))))return void r.push([""+o,t]);var p=Object.keys(u).filter((function(e){return a(e,s.ignoreFields)})).length>0,d="object"==typeof u.__args&&Object.keys(u.__args).length>0,c="object"==typeof u.__directives,y=u.__all_on instanceof Array,l="object"==typeof u.__on,f=""+o;if("string"==typeof u.__name&&(f=f+" "+u.__name),"string"==typeof u.__aliasFor&&(f=f+": "+u.__aliasFor),"object"==typeof u.__variables)f=f+" ("+function(e){var t=[];for(var n in e)t.push("$"+n+": "+e[n]);return t.join(", ")}(u.__variables)+")";else if(d||c){var b="",m="";c&&(m=Object.entries(u.__directives).map((function(e){var t;return"@"+function(e){var t=Object.keys(e)[0],a=e[t];if("boolean"==typeof a)return t;if("object"==typeof a){var i=[];for(var r in a){var s=n(a[r]).replace(/"/g,"");i.push(r+": "+s)}return t+"("+i.join(", ")+")"}throw new Error("Unsupported type for directive: "+typeof a+". Types allowed: object, boolean.\nOffending object: "+JSON.stringify(e))}(((t={})[e[0]]=e[1],t))})).join(" ")),d&&(b="("+function(e){var t=[];for(var a in e)t.push(a+": "+n(e[a]));return t.join(", ")}(u.__args)+")"),f=f+" "+m+(c&&d?" ":"")+b}if(r.push([f+(p||l||y?" {":""),t]),i(u,t+1,r,s),y&&u.__all_on.forEach((function(e){r.push(["..."+e,t+1])})),l)(u.__on instanceof Array?u.__on:[u.__on]).forEach((function(e){var n=e.__typeName;r.push(["... on "+n+" {",t+1]),i(e,t+2,r,s),r.push(["}",t+1])}));(p||l||y)&&r.push(["}",t])}else(!0===s.includeFalsyKeys||u)&&r.push([""+o,t])}))}Object.defineProperty(t,"__esModule",{value:!0}),t.configFields=["__args","__alias","__aliasFor","__variables","__directives","__on","__all_on","__typeName","__name"],t.jsonToGraphQLQuery=function(e,t){if(void 0===t&&(t={}),!e||"object"!=typeof e)throw new Error("query object not specified");if(0==Object.keys(e).length)throw new Error("query object has no data");t.ignoreFields instanceof Array||(t.ignoreFields=[]);var n=[];i(e,0,n,t);var a="";return n.forEach((function(e){var n=e[0],i=e[1];t.pretty?(a&&(a+="\n"),a+=function(e){return Array(4*e+1).join(" ")}(i)+n):(a&&(a+=" "),a+=n)})),a}}));let l=(f=t((function*(e,t,n={}){const a=yield fetch(e,{method:"POST",headers:i({Accept:"application/json","Content-Type":"application/json"},n?.headers),body:JSON.stringify({query:y.jsonToGraphQLQuery({query:t})})}),{data:r}=yield a.json();return r||{}})),function(e,t){return f.apply(this,arguments)});var f;let b=(m=t((function*(e,t,n,a,i={}){let r=(yield t.getNetwork()).chainId;const o=new ethers.Contract(s[r].MULTICALL,["function aggregate(tuple(address target, bytes callData)[] calls) view returns (uint256 blockNumber, bytes[] returnData)","function getFNFT(uint fnftId) external view returns (tuple(address asset, address pipeToContract, uint depositAmount, uint depositMul, uint split, uint depositStopTime, bool maturityExtension, bool isMulti, bool nontransferrable))"],t),u=new ethers.utils.Interface(n);try{const e=i?.limit||500,t=Math.ceil(a.length/e),n=[];Array.from(Array(t)).forEach((function(t,r){const s=a.slice(e*r,e*(r+1));n.push(o.aggregate(s.map((function(e){return[e[0].toLowerCase(),u.encodeFunctionData(e[1],e[2])]})),i||{}))}));let r=yield Promise.all(n);return r=r.reduce((function(e,[,t]){return e.concat(t)}),[]),r.map((function(e,t){return u.decodeFunctionResult(a[t][1],e)}))}catch(e){return Promise.reject(e)}})),function(e,t,n,a){return m.apply(this,arguments)});var m;let h=(T=t((function*(){return new IntersectionObserver((function(e){e.filter((function(e){return e.isIntersecting})).forEach((function(e){e.target.childNodes[0].src||(e.target.childNodes[0].setAttribute("src",e.target.childNodes[0].dataset.src),e.target.childNodes[0].style.zIndex=999)}))}),{root:null,threshold:new Array(101).fill(0).map((function(e,t){return.01*t}))})})),function(){return T.apply(this,arguments)});var T;return class{constructor(e){var a,i,u=this;n(this,"renderAllFNFTs",(()=>{var e=t((function*(e){try{return console.log(e),u.observer=yield h(),e.reduce((function(e,t){return e.then((function(e){return fetch(t.url).then((function(e){return e.json()})).then((function(e){return fetch(e.animation_url).then((function(e){return e.text()})).then((function(e,n){const a=document.createElement("div"),i=document.createElement("embed"),r=new Blob([e],{type:"text/html"});return a.className="card",i.frameborder=0,i.className="lazyload",i.width="300",i.height="460",i.style.width="300",i.id="fnft_"+t.id,i.style.height="460",i.wmode="transparent",i.dataset.src=window.URL.createObjectURL(r),a.appendChild(i),document.getElementById(u._divId).appendChild(a),u.observer.observe(a),Promise.resolve(n+1)}))}))}))}),Promise.resolve(1))}catch(e){console.log(e)}}));return function(t){return e.apply(this,arguments)}})()),n(this,"getAllFNFTsForUser",(()=>{var e=t((function*(e,t,n){let a=(yield t.getNetwork()).chainId;const i=[e],u=new ethers.Contract(s[a].ROUTER,o,t),p=yield u.getRevestFNFT();let d=[];const c={accounts:{__args:{where:{id_in:i.map((function(e){return e.toLowerCase()}))}},id:!0,balances:{value:!0,token:{registry:{id:!0},identifier:!0}}}};if((yield l(r[a],c)).accounts[0].balances.forEach((function(e){e.token.registry.id.toLowerCase()===p.toLowerCase()&&"0"!=e.value&&d.push(Number(e.token.identifier))})),n)return d;return yield(yield fetch("https://api.revest.finance:3000/metadata?chainId="+a+"&id="+d.ids.sort((function(e,t){return t-e})).join(","))).json()}));return function(t,n,a){return e.apply(this,arguments)}})()),n(this,"getFNFTsForUserAndContractWithURI",(()=>{var e=t((function*(e,t,n){try{const a=["function uri(uint fnftId) external view returns (string memory)"];let i=(yield n.getNetwork()).chainId,r=yield getFNFTsForUserAndContract(e,t,n),s=allFNFTsForUser.ids,o=yield b(i,n,a,s.map((function(e){return[r.nftAddress,"uri",[e]]}))),u={};return o.forEach((function(e,t){u[s[t]]={uri:e[0]}})),r.fnfts=u,r}catch(e){console.log(e)}}));return function(t,n,a){return e.apply(this,arguments)}})()),n(this,"getFNFTsForUserAndContract",(a=t((function*(e,t,n){try{const a=["function getFNFT(uint fnftId) external view returns (tuple(address asset, address pipeToContract, uint depositAmount, uint depositMul, uint split, uint depositStopTime, bool maturityExtension, bool isMulti, bool nontransferrable))"];let i=(yield n.getNetwork()).chainId,r=yield u.getAllFNFTsForUser(e,n,!0),p=r;const d=new ethers.Contract(s[i].ROUTER,o,n),c=yield d.getTokenVault();let y=yield b(i,n,a,p.map((function(e){return[c,"getFNFT",[e]]}))),l=[];return y.forEach((function(e,n){e[0].pipeToContract.toLowerCase()==t.toLowerCase()&&l.push(p[n])})),r.ids=l,r.contractAddress=t,r.vaultAddress=c,yield(yield fetch("https://api.revest.finance:3000/metadata?chainId="+i+"&id="+r.ids.sort((function(e,t){return t-e})).join(","))).json()}catch(e){console.log(e)}})),function(e,t,n){return a.apply(this,arguments)})),n(this,"filterFNFTIdListByMaturityDate",(i=t((function*(e,t,n){let a=(yield n.getNetwork()).chainId;const i=new ethers.Contract(s[a].ROUTER,o,n);let r=yield i.getRevest();const u=new ethers.Contract(r,"event FNFTTimeLockMinted(address indexed asset, address indexed from, uint indexed fnftId, uint endTime, uint[] quantities, tuple(address asset, address pipeToContract, uint depositAmount, uint depositMul, uint split, uint depositStopTime, bool maturityExtension, bool isMulti, bool nontransferrable) fnftConfig);",n);let p=u.filters.TimeLockEvent(null,null,e);p.fromBlock=s[network].MIN_BLOCK,p.toBlock="latest";let d=(yield n.getLogs(p)).map((function(e){return u.interface.parseLog(e)})),c=[];for(let e in d){let n=d[e].args,a=Number(n.endTime.toString());a<=t&&c.push({id:Number(n.fnftId.toString()),endTime:a})}return c=c.sort((function(e,t){return e.endTime-t.endTime})).map((function(e){return e.id})),c})),function(e,t,n){return i.apply(this,arguments)})),this._divId=e,this.observer}}}));
